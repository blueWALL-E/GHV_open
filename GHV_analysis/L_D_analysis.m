%{
/*
 * @Author: blueWALL-E
 * @Date: 2025-10-30 10:27:16
 * @LastEditTime: 2025-10-30 20:59:58
 * @FilePath: \GHV_open\GHV_analysis\L_D_analysis.m
 * @Description: 飞行器升阻比分析
 * @Wearing:  Read only, do not modify place!!!
 * @Shortcut keys:  ctrl+alt+/ ctrl+alt+z
 */
%}
M_vals = linspace(4, 24, 300); % 马赫数
ALPHA_vals = linspace(0, 12, 300); % 攻角

[M, ALPHA] = ndgrid(M_vals, ALPHA_vals);
LE = 0;
RE = 0;
RUD = 0;

CLbv = -8.19E-02 ...
    +4.70E-02 * M ...
    +1.86E-02 * ALPHA ...
    -4.73E-04 * (ALPHA .* M) ...
    -9.19E-03 * M .^ 2 ...
    -1.52E-04 * ALPHA .^ 2 ...
    +5.99E-07 * (ALPHA .* M) .^ 2 ...
    +7.74E-04 * M .^ 3 ...
    +4.08E-06 * ALPHA .^ 3 ...
    -2.93E-05 * M .^ 4 ...
    -3.91E-07 * ALPHA .^ 4 ...
    +4.12E-07 * M .^ 5 ...
    +1.30E-08 * ALPHA .^ 5;
CL_RE = -1.45E-05 ...
    +1.01E-04 * ALPHA ...
    +7.10E-06 * M ...
    -4.14E-04 * RE ...
    -3.51E-06 * (ALPHA .* RE) ...
    +4.70E-06 * (ALPHA .* M) ...
    +8.72E-06 * (M .* RE) ...
    -1.70E-07 * (ALPHA .* M) .* RE;
CL_LE = -1.45E-05 ...
    +1.01E-04 * ALPHA ...
    +7.10E-06 * M ...
    -4.14E-04 * LE ...
    -3.51E-06 * (ALPHA .* LE) ...
    +4.70E-06 * (ALPHA .* M) ...
    +8.72E-06 * (M .* LE) ...
    -1.70E-07 * (ALPHA .* M) .* LE;
CL = CLbv + CL_RE + CL_LE;

CDbv = 8.717E-02 ...
    -3.307E-02 * M ...
    +3.179E-03 * ALPHA ...
    -1.250E-04 * (ALPHA .* M) ...
    +5.036E-03 * M .^ 2 ...
    -1.100E-03 * ALPHA .^ 2 ...
    +1.405E-07 * (ALPHA .* M) .^ 2 ...
    -3.658E-04 * M .^ 3 ...
    +3.175E-04 * ALPHA .^ 3 ...
    +1.274E-05 * M .^ 4 ...
    -2.985E-05 * ALPHA .^ 4 ...
    -1.705E-07 * M .^ 5 ...
    +9.766E-07 * ALPHA .^ 5;
CD_RE = 4.5548e-004 ...
    +2.5411e-005 * ALPHA ...
    -1.1436e-004 * M ...
    -3.6417e-005 * RE ...
    -5.3015e-007 * ((ALPHA .* M) .* RE) ...
    +3.2187e-006 * (ALPHA .^ 2) ...
    +3.0140e-006 * (M .^ 2) ...
    +6.9629e-006 * (RE .^ 2) ...
    +2.1026e-012 * (((ALPHA .* M) .* RE) .^ 2);
CD_LE = 4.5548e-004 ...
    +2.5411e-005 * ALPHA ...
    -1.1436e-004 * M ...
    -3.6417e-005 * LE ...
    -5.3015e-007 * ((ALPHA .* M) .* LE) ...
    +3.2187e-006 * (ALPHA .^ 2) ...
    +3.0140e-006 * (M .^ 2) ...
    +6.9629e-006 * (LE .^ 2) ...
    +2.1026e-012 * (((ALPHA .* M) .* LE) .^ 2);
CD_RUD = +7.50E-04 ...
    -2.29E-05 * ALPHA ...
    -9.69E-05 * M ...
    -1.83E-06 * RUD ...
    +9.13E-09 * (ALPHA .* M) .* RUD ...
    +8.76E-07 * ALPHA .^ 2 ...
    +2.70E-06 * M .^ 2 ...
    +1.97E-06 * RUD .^ 2 ...
    -1.77E-11 * ((ALPHA .* M) .* RUD) .^ 2;
CD = CDbv + CD_RE + CD_LE + CD_RUD;

L_D = CL ./ CD;

% ----------------------------------------
% 计算每个马赫数下的最佳升阻比对应的攻角（山脊线）
% ----------------------------------------
[num_M, num_alpha] = size(L_D);

alpha_opt = zeros(1, num_M); % 每个 M 下最优攻角
LD_opt = zeros(1, num_M); % 每个 M 下的最大 L/D

for i = 1:num_M
    % 对第 i 个 M，把这一行所有攻角的 L/D 都拿来比
    [LD_opt(i), idx] = max(L_D(i, :)); % <= 这里改成行
    alpha_opt(i) = ALPHA(i, idx); % 取对应的攻角
end

figure;
surf(M, ALPHA, L_D); % 三维曲面
shading interp; % 平滑一下表面
colormap(jet); % 使用jet颜色图
colorbar; % 显示颜色对应值
xlabel('Mach Number M');
ylabel('\alpha (deg)');
zlabel('L_D');
title('L_D vs Mach & Angle of Attack');
grid on;

figure;
contourf(M, ALPHA, L_D, 300, 'LineStyle', 'none');
colormap(jet);
colorbar;
xlabel('Mach Number M');
ylabel('\alpha (deg)');
title('L/D Contour (Mach vs Angle of Attack)');
axis tight;
hold on;
plot(M_vals, alpha_opt, 'k-', 'LineWidth', 2.5); % 把山脊线压上去
hold off;
