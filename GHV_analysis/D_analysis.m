%{
/*
 * @Author: blueWALL-E
 * @Date: 2025-10-28 11:22:29
 * @LastEditTime: 2025-11-03 19:02:01
 * @FilePath: \GHV_open\GHV_analysis\D_analysis.m
 * @Description: 阻力系数分析脚本
 * @Wearing:  Read only, do not modify place!!!
 * @Shortcut keys:  ctrl+alt+/ ctrl+alt+z
 */
%}
M_vals = linspace(4, 24, 50); % 马赫数范围，可按需要修改
ALPHA_vals = linspace(0, 12, 50); % 攻角范围(度)，可按需要修改
% 2. 固定给定条件 (你自己填实际值)
RE = 0; % 示例: 雷诺数或者某个代表量
LE = 0; % 示例: 另一边界层/长度相关量
RUD = 0;
% 上面这两个只是示意，请换成你题目里“给定的 LE 和 RE”
[M, ALPHA] = meshgrid(M_vals, ALPHA_vals);
CDbv = 8.717E-02 ...
    -3.307E-02 * M ...
    +3.179E-03 * ALPHA ...
    -1.250E-04 * (ALPHA .* M) ...
    +5.036E-03 * M .^ 2 ...
    -1.100E-03 * ALPHA .^ 2 ...
    +1.405E-07 * (ALPHA .* M) .^ 2 ...
    -3.658E-04 * M .^ 3 ...
    +3.175E-04 * ALPHA .^ 3 ...
    +1.274E-05 * M .^ 4 ...
    -2.985E-05 * ALPHA .^ 4 ...
    -1.705E-07 * M .^ 5 ...
    +9.766E-07 * ALPHA .^ 5;
CD_RE = 4.5548e-004 ...
    +2.5411e-005 * ALPHA ...
    -1.1436e-004 * M ...
    -3.6417e-005 * RE ...
    -5.3015e-007 * ((ALPHA .* M) .* RE) ...
    +3.2187e-006 * (ALPHA .^ 2) ...
    +3.0140e-006 * (M .^ 2) ...
    +6.9629e-006 * (RE .^ 2) ...
    +2.1026e-012 * (((ALPHA .* M) .* RE) .^ 2);
CD_LE = 4.5548e-004 ...
    +2.5411e-005 * ALPHA ...
    -1.1436e-004 * M ...
    -3.6417e-005 * LE ...
    -5.3015e-007 * ((ALPHA .* M) .* LE) ...
    +3.2187e-006 * (ALPHA .^ 2) ...
    +3.0140e-006 * (M .^ 2) ...
    +6.9629e-006 * (LE .^ 2) ...
    +2.1026e-012 * (((ALPHA .* M) .* LE) .^ 2);
CD_RUD = +7.50E-04 ...
    -2.29E-05 * ALPHA ...
    -9.69E-05 * M ...
    -1.83E-06 * RUD ...
    +9.13E-09 * (ALPHA .* M) .* RUD ...
    +8.76E-07 * ALPHA .^ 2 ...
    +2.70E-06 * M .^ 2 ...
    +1.97E-06 * RUD .^ 2 ...
    -1.77E-11 * ((ALPHA .* M) .* RUD) .^ 2;

CD = CDbv + CD_RE + CD_LE + CD_RUD;
% --- 三维曲面 ---
figure;
surf(M, ALPHA, CD); % 三维曲面
shading interp; % 平滑一下表面
colorbar; % 颜色条表示CL大小
xlabel('Mach Number M');
ylabel('\alpha (deg)');
zlabel('C_D');
title('C_D vs Mach & Angle of Attack');
grid on;
% --- 俯视等高线图 ---
figure;
contourf(M, ALPHA, CD, 30, 'LineColor', 'none'); % 30条等高线，填充颜色
colorbar;
xlabel('Mach Number M');
ylabel('\alpha (deg)');
title('C_D Contour Map (俯视等高线图)');
grid on;
% 选几个感兴趣的攻角（单位与你定义的 ALPHA 一致）
figure;
hold on; grid on;
alpha_list = 0:1:12; % 攻角范围
colors = jet(length(alpha_list)); % 蓝到红渐变

for i = 1:length(alpha_list)
    a = alpha_list(i);
    [~, idx] = min(abs(ALPHA_vals - a));
    plot(M_vals, CD(idx, :), 'Color', colors(i, :), ...
        'LineWidth', 2, ...
        'DisplayName', sprintf('\\alpha = %.1f°', a));
end

xlabel('Mach Number M');
ylabel('C_D');
title('C_D vs Mach at Different Angles of Attack');
legend('show', 'Location', 'eastoutside');
% ✅ 正确设置 colorbar
colormap(colors);
cbar = colorbar; % 获取 colorbar 句柄
cbar.Ticks = linspace(0, 1, length(alpha_list));
cbar.TickLabels = arrayfun(@(x) sprintf('%.0f°', x), alpha_list, 'UniformOutput', false);
ylabel(cbar, 'Angle of Attack (\alpha)', 'Rotation', 270); % 设置 colorbar 标签
